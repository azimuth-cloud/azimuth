{{- $component := "api" -}}
{{- $values := get .Values $component -}}
{{- if $values.monitoring.enabled -}}
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: {{ include "azimuth.componentname" (list . $component) }}
  # Labels must match .podMonitorSelector.matchLabels of the Prometheus cluster resource
  #Â in order for kube-prometheus-stack to scrape the endpoints defined here
  labels: {{ toYaml $values.monitoring.serviceMonitorLabels | nindent 4 }}
spec:
  selector:
    matchLabels: {{ include "azimuth.componentLabels" (list . $component) | nindent 6 }}
      api.kubernetes.io/sub-component: {{ include "azimuth.componentname" (list . $component) }}-statsd-exporter
  endpoints:
  - port: metrics
  namespaceSelector:
    matchNames: 
    # Restrict the ServiceMonitor to the relevant namespace
    - {{ .Release.Namespace }}
{{ end }}